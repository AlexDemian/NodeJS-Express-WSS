<!DOCTYPE html>
<html>
  <body>
    <div>
      <h3>Text input</h3>
      <input id="messageInput" />
      <button id="sendTextButton">Send</button>

      <h3>File input</h3>
      <input type="file" id="fileInput" />
      <button id="sendFileButton">Send</button>
      <br />
      <br />
      <i>Max-size: 150MB</i>
    </div>

    <hr />

    <div style="margin-top: 25px">
      <h3>Server response</h3>
      <div id="response"></div>
    </div>

    <script>
      connect();

      function connect() {
        const responses = [];
        const socket = new WebSocket(
          "ws://localhost:3000?token=definitely_secure_token"
        );

        socket.addEventListener("open", (event) => {
          console.log("WS connection is set up.");

          let button = document.getElementById("sendTextButton");
          button.onclick = (event) => {
            const input = document.getElementById("messageInput");
            socket.send(input.value);
            input.value = "";
            input.focus();
          };

          button = document.getElementById("sendFileButton");
          button.onclick = (event) => {
            const input = document.getElementById("fileInput");
            socket.send(input.files[0]);
            input.value = "";
          };
        });

        socket.addEventListener("message", (event) => {
          responses.unshift(`${new Date().toISOString()}: ${event.data}`);
          const container = document.getElementById("response");
          container.innerHTML = responses.join("<br>");
        });

        socket.onclose = function (event) {
          console.log(
            "Socket is closed. Reconnect will be attempted in 1 second.",
            event.reason
          );
          setTimeout(connect, 1000);
        };
      }
    </script>
  </body>
</html>
